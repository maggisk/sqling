# SqLing

## Typescript type generator for your postgres sql queries

### Why?

Sql is nice. Types are nice.

It gives you a huge confidence boost to validate all your queries at compile time and have types for everything interacting with the database to avoid mistakes.

### How?

`yarn add sqling` or `npm install sqling`

You also need ts-node for development only

`yarn add ts-node -D` or `npm install ts-node --save-dev`

create a `sqling.js` file in your project containing the following

```
require("ts-node").register();
const sqling = require("sqling");

sqling.generate({
  glob: "src/**/*.sql.ts",
  pgConfig: {
    host: "localhost",
    password: "postgres",
    user: "postgres",
    database: "your-db"
  }
});
```

and run it with `node sqling.js`. This will create a watcher that creates a
corresponding `.ts` file every time your `.sql.ts` changes

now write your queries in the `src` directory e.g. `users.sql.ts`

```
import { sql, f } from 'sqling'

export const paginateUsers = sql`
SELECT * FROM users
LIMIT ${f.limit}
OFFSET ${f.offset}
`
```

now you can import `src/users` and run the query with something like

```
import { Pool } from 'pg'
import { paginateUsers } from './users'
// ...
const db = new Pool()
const users = await paginateUsers.all(db, { offset: 0, limit: 10 })
```

### Status

Early alpha. Proof of concept and barely usable :)

### TODOs

Roughly in order

- [ ] fix error handling when there is an error in query
- [ ] fix types to allow null for optional paremeter values and return values
- [ ] improve tests
- [ ] publish to npm
- [ ] decide how to deal with 64 bit integers sent to/from postgres (strings at the moment which is annoying)
- [ ] support for inserting multiple rows in a single query
- [ ] support for more builtin postgresql types
- [ ] more flexibility in where generated files are stored
- [ ] `sqlFragment` function for re-usable where conditions etc.
- [ ] support for custom field types with encode/decode transformers?
- [ ] autogenerated CRUD functions


## Inspiration

[yesql](https://github.com/krisajenkins/yesql), [pugsql](https://pugsql.org/), [sqlc](https://github.com/kyleconroy/sqlc) and more.

Props to [pg-typed](https://github.com/adelsz/pgtyped) which is a similar library for postgres and typescript but I found some features missing, like support for query fragments, `ANY`, cursors and better types. I attempted to add those features myself but the codebase was huge and complex (and a little scary), so I decided to make my own minimal implementation.
